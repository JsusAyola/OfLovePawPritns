<div class="prediction-container">
  <h2 class="title">Predicción de Probabilidad de Adopción</h2>

  <form [formGroup]="predictionForm" (ngSubmit)="onSubmit()" class="form-layout">

    <div class="column">
      <mat-accordion multi>
        <!-- Información Básica -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Información Básica</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="fill">
            <mat-label>Tipo</mat-label>
            <mat-select formControlName="type">
              <mat-option value="Perro">Perro</mat-option>
              <mat-option value="Gato">Gato</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Raza</mat-label>
            <mat-select formControlName="breed">
              <mat-option value="Labrador">Labrador</mat-option>
              <mat-option value="Bulldog">Bulldog</mat-option>
              <mat-option value="Persa">Persa</mat-option>
              <mat-option value="Husky">Husky</mat-option>
              <mat-option value="Siames">Siames</mat-option>
              <mat-option value="Mestizo">Mestizo</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Sexo</mat-label>
            <mat-select formControlName="sex">
              <mat-option value="Hembra">Hembra</mat-option>
              <mat-option value="Macho">Macho</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>

        <!-- Características Físicas -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Características Físicas</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="fill">
            <mat-label>Tamaño</mat-label>
            <mat-select formControlName="size">
              <mat-option value="Pequeño">Pequeño</mat-option>
              <mat-option value="Mediano">Mediano</mat-option>
              <mat-option value="Grande">Grande</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Peso</mat-label>
            <mat-select formControlName="weight">
              <mat-option value="Menos de 5kg">Menos de 5kg</mat-option>
              <mat-option value="5-15kg">5-15kg</mat-option>
              <mat-option value="15-30kg">15-30kg</mat-option>
              <mat-option value="Más de 30kg">Más de 30kg</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>
      </mat-accordion>
    </div>

    <div class="column">
      <mat-accordion multi>
        <!-- Salud y Cuidados -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Salud y Cuidados</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="fill">
            <mat-label>Vacunas</mat-label>
            <mat-select formControlName="vaccines">
              <mat-option value="Rabia">Rabia</mat-option>
              <mat-option value="Parvovirus">Parvovirus</mat-option>
              <mat-option value="Leptospirosis">Leptospirosis</mat-option>
              <mat-option value="Hepatitis Infecciosa Canina">Hepatitis Infecciosa Canina</mat-option>
              <mat-option value="Moquillo">Moquillo</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Esterilizado</mat-label>
            <mat-select formControlName="sterilized">
              <mat-option value="Sí">Sí</mat-option>
              <mat-option value="No">No</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Condiciones Médicas</mat-label>
            <mat-select formControlName="medicalConditions">
              <mat-option value="Ninguna">Ninguna</mat-option>
              <mat-option value="Afecciones respiratorias">Afecciones respiratorias</mat-option>
              <mat-option value="Lesiones previas">Lesiones previas</mat-option>
              <mat-option value="Enfermedades crónicas">Enfermedades crónicas</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Alergias</mat-label>
            <mat-select formControlName="allergies">
              <mat-option value="Ninguna">Ninguna</mat-option>
              <mat-option value="Medicamentos">Medicamentos</mat-option>
              <mat-option value="Polen">Polen</mat-option>
              <mat-option value="Polvo">Polvo</mat-option>
              <mat-option value="Alimentos">Alimentos</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>

        <!-- Comportamiento -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Comportamiento</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="fill">
            <mat-label>Nivel de Actividad</mat-label>
            <mat-select formControlName="activityLevel">
              <mat-option value="Bajo">Bajo</mat-option>
              <mat-option value="Medio">Medio</mat-option>
              <mat-option value="Alto">Alto</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Comportamiento con Personas</mat-label>
            <mat-select formControlName="behaviorPeople">
              <mat-option value="Tímido">Tímido</mat-option>
              <mat-option value="Amigable">Amigable</mat-option>
              <mat-option value="Agresivo">Agresivo</mat-option>
              <mat-option value="Sociable">Sociable</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Comportamiento con Animales</mat-label>
            <mat-select formControlName="behaviorAnimals">
              <mat-option value="Tímido">Tímido</mat-option>
              <mat-option value="Amigable">Amigable</mat-option>
              <mat-option value="Agresivo">Agresivo</mat-option>
              <mat-option value="Sociable">Sociable</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>

        <!-- Confirmación de Propiedad -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Confirmación de Propiedad</mat-panel-title>
          </mat-expansion-panel-header>

          <mat-form-field appearance="fill">
            <mat-label>¿Tiene dueño actualmente?</mat-label>
            <mat-select formControlName="ownershipConfirmation">
              <mat-option value="Sí">Sí</mat-option>
              <mat-option value="No">No</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>¿Adoptado?</mat-label>
            <mat-select formControlName="adopted">
              <mat-option value="Sí">Sí</mat-option>
              <mat-option value="No">No</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>
      </mat-accordion>
    </div>

    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="predictionForm.invalid || isLoading">
        {{ isLoading ? 'Procesando...' : 'Predecir Probabilidad de Adopción' }}
      </button>
      <button mat-stroked-button color="warn" type="button" (click)="resetForm()" [disabled]="isLoading">
        Limpiar Formulario
      </button>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      <mat-icon>error_outline</mat-icon> {{ errorMessage }}
    </div>
  </form>

  <!-- Resultados de la Predicción -->
  <div class="prediction-result" *ngIf="predictionResult">
    <h3>Resultado de la Predicción</h3>
    <div class="result-message">
      <p><strong>Mensaje:</strong> {{ predictionResult.message }}</p>
      <p><strong>Confianza:</strong> {{ predictionResult.confidenceLevel }}</p>
    </div>

    <div class="result-details">
      <p><strong>Probabilidad de adopción:</strong> {{ predictionResult.prediction.confidence * 100 }}%</p>
      <p><strong>Estado de la predicción:</strong> {{ predictionResult.prediction.willBeAdopted ? 'Adoptable' : 'No adoptable' }}</p>
    </div>

    <div *ngIf="predictionResult.prediction.willBeAdopted" class="result-positive">
      <p><strong>¡Este animal tiene muchas probabilidades de ser adoptado!</strong></p>
      <p>¡Compártelo con tu red para aumentar las posibilidades de encontrarle un hogar!</p>
    </div>

    <div *ngIf="!predictionResult.prediction.willBeAdopted" class="result-negative">
      <p><strong>Este animal podría necesitar más apoyo para ser adoptado.</strong></p>
      <p>Te sugerimos trabajar en mejorar su perfil o compartirlo con organizaciones de rescate.</p>
    </div>
  </div>
</div>
